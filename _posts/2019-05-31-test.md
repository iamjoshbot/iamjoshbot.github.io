---
title: "Improving Django's PasswordResetConfirmView"
date: 2019-05-31T20:17:30-04:00
categories:
  - django programming
tags:
  - django programming owasp IDOR 
---

Django provides some fantastic helpers for handling user authentication, password resets and changes.

Upon implementing password reset functionality I found a small part of the built in PasswordResetConfirmView that I wasn't happy with. The default email sent to a user to reset their password contains a url linking to the password reset page. This url, whilst adequately secure, contains the base64 encoded id of the given user.

The problem with showing this id to the user is:

⋅⋅* It reveals to the user how many other users your site may have. (If their id is 350, they can guess you have at least 350 users)
⋅⋅* It provides to the user the primary key of their user account in the database which could aid in the exploitation of Insecure Direct Object Reference (IDOR).


#### models.py

```python
import uuid
from django.db import models
from django.db.models.signals import post_save
from django.contrib.auth.models import User
from django.dispatch import receiver


class Profile(models.Model):
  user = models.OneToOneField(User, on_delete=models.CASCADE)
  account_id = models.UUIDField(unique=True, default=uuid.uuid4)


@receiver(post_save, sender=User)
def create_user_profile(sender, instance, created, **kwargs):
    if created:
        Profile.objects.create(user=instance)


@receiver(post_save, sender=User)
def save_user_profile(sender, instance, **kwargs):
    instance.profile.save()
```
